<!DOCTYPE html>

<html>

<head>

  <title>Tap Tap Cookie</title>

  <style>

    #cookie {

      width: 200px;

      height: 200px;

      background-image: url('cookie.png');

      background-size: cover;

      cursor: pointer;

    }

    #loginButton {

      background-image: url('login-button.png');

      width: 150px;

      height: 50px;

      cursor: pointer;

    }

  </style>

  <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>

  <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-database.js"></script>

  <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-auth.js"></script>

</head>

<body>

  <div id="loginPage">

    <h1>Login</h1>

    <input type="text" id="usernameInput" placeholder="Username">

    <div id="loginButton" onclick="login()"></div>

  </div>

  <div id="gamePage" style="display: none;">

    <h1>Welcome <span id="username"></span>!</h1>

    <h2>Score: <span id="score">0</span></h2>

    <div id="cookie"></div>

    <h2>Leaderboard</h2>

    <ol id="leaderboard"></ol>

  </div>

  <script>

    // Konfigurasi Firebase

    var firebaseConfig = {

      apiKey: "AIzaSyBMUFoehYxHGwdXgDaQFwcYy1PiOQXnSkg",

      authDomain: "tapcookieonline.firebaseapp.com",

      databaseURL: "https://tapcookieonline-default-rtdb.firebaseio.com",

      projectId: "tapcookieonline",

      storageBucket: "tapcookieonline.appspot.com",

      messagingSenderId: "493293620415",

      appId: "1:493293620415:web:a1e97f68243dc3bbcd0a0a"

    };

    // Inisialisasi Firebase

    firebase.initializeApp(firebaseConfig);

    var auth = firebase.auth();

    var database = firebase.database();

    // Mendapatkan referensi leaderboard

    var leaderboardRef = database.ref('leaderboard');

    // Mendapatkan elemen-elemen dari DOM

    var loginPage = document.getElementById('loginPage');

    var gamePage = document.getElementById('gamePage');

    var cookie = document.getElementById('cookie');

    var scoreDisplay = document.getElementById('score');

    var usernameInput = document.getElementById('usernameInput');

    var usernameDisplay = document.getElementById('username');

    // Inisialisasi skor dan penghitung klik

    var score = 0;

    var clickCount = 0;

    // Cek status autentikasi saat halaman dimuat

    firebase.auth().onAuthStateChanged(function(user) {

      if (user) {

        // User sudah login

        showGamePage(user.displayName);

      } else {

        // User belum login

        showLoginPage();

      }

    });

    function login() {

      var username = usernameInput.value;

      if (username.trim() === '') {

        alert('Please enter your username.');

        return;

      }

      // Set username

      usernameDisplay.textContent = username;

      // Tampilkan halaman permainan dan sembunyikan halaman login

      loginPage.style.display = 'none';

      gamePage.style.display = 'block';

      // Menambahkan event listener untuk klik pada cookie

      cookie.addEventListener('click', function() {

        score++;

        scoreDisplay.textContent = score.toString();

      });

      // Mendapatkan data leaderboard dari Firebase dan memperbarui tampilan

      leaderboardRef.on('value', function(snapshot) {

        var leaderboard = snapshot.val();

        updateLeaderboard(leaderboard);

      });

    }

    function updateLeaderboard(leaderboard) {

      // Menghapus entri leaderboard yang sebelumnya ditampilkan

      var leaderboardElement = document.getElementById('leaderboard');

      leaderboardElement.innerHTML = '';

      // Mengurutkan leaderboard berdasarkan skor secara menurun

      var sortedLeaderboard = Object.entries(leaderboard).sort((a, b) => b[1] - a[1]);

      // Memperbarui tampilan leaderboard

      sortedLeaderboard.forEach(function(entry, index) {

        var username = entry[0];

        var score = entry[1];

        var listItem = document.createElement('li');

        listItem.textContent = username + ': ' + score;

        leaderboardElement.appendChild(listItem);

        // Jika pemain saat ini adalah pemain dengan skor tertinggi, berikan penanda

        if (index === 0 && username === usernameDisplay.textContent) {

          listItem.style.fontWeight = 'bold';

        }

      });

    }

    function showLoginPage() {

      loginPage.style.display = 'block';

      gamePage.style.display = 'none';

    }

    function showGamePage(username) {

      usernameDisplay.textContent = username;

      loginPage.style.display = 'none';

      gamePage.style.display = 'block';

    }

  </script>

</body>

</html>
